<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calculadora de garantía</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-rose-100 via-sky-100 to-violet-100 min-h-screen flex items-center justify-center font-sans p-4">

  <div class="bg-white/90 backdrop-blur shadow-2xl rounded-3xl p-6 md:p-8 w-full max-w-md border border-white/40">
    <h1 class="text-2xl md:text-3xl font-bold mb-6 text-center text-slate-700">
      Calculadora de garantía
    </h1>

    <div class="mb-5 bg-sky-50 rounded-xl p-3">
      <label class="text-sm text-slate-500">Cotización BNA (Venta)</label>
      <div id="rate" class="text-xl font-semibold text-slate-700">Cargando...</div>
      <div id="update" class="text-xs text-slate-400"></div>
    </div>

    <div class="mb-4">
      <label class="text-sm text-slate-500">Monto en USD</label>
      <input
        id="usd"
        type="number"
        placeholder="Ej: 100"
        class="w-full border border-sky-100 rounded-xl p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-sky-200"
      />
    </div>

    <div class="mb-4">
      <label class="text-sm text-slate-500">Cantidad de noches</label>
      <input
        id="nights"
        type="number"
        placeholder="Ej: 2"
        class="w-full border border-violet-100 rounded-xl p-3 mt-1 focus:outline-none focus:ring-2 focus:ring-violet-200"
      />
      <div class="text-xs text-slate-400 mt-1">AR$ 50.000 por noche</div>
    </div>

    <div class="mb-4 flex items-center gap-2">
      <input id="paxArgentino" type="checkbox" class="w-4 h-4" />
      <label class="text-sm text-slate-600">Pax argentino (sumar IVA 21%)</label>
    </div>

    <div class="flex flex-col gap-3 mt-6">
      <button
        onclick="convert()"
        class="w-full bg-sky-300 text-slate-800 font-semibold py-3 rounded-xl hover:bg-sky-400 transition shadow-sm"
      >
        Calcular garantía
      </button>

      <button
        onclick="showPrevious()"
        class="w-full bg-violet-200 text-slate-700 py-3 rounded-xl hover:bg-violet-300 transition"
      >
        Ver garantía anterior
      </button>

      <button
        onclick="resetCalc()"
        class="w-full bg-rose-200 text-slate-700 py-3 rounded-xl hover:bg-rose-300 transition"
      >
        Reiniciar gtia
      </button>
    </div>

    <div class="mt-8 text-center bg-white rounded-2xl p-4 shadow-inner">
      <div class="text-sm text-slate-400">Total en ARS</div>
      <div id="ars" class="text-3xl font-bold text-slate-700">—</div>
    </div>

    <div id="detail" class="mt-4 text-sm text-slate-600 bg-white/70 p-4 rounded-2xl"></div>
  </div>

  <script>
    let exchangeRate = null;
    const NIGHT_PRICE = 50000;

    async function fetchRate() {
      try {
        const response = await fetch("https://api.bluelytics.com.ar/v2/latest");
        const data = await response.json();

        exchangeRate = data.oficial.value_sell;

        document.getElementById("rate").innerText =
          "$" + exchangeRate.toFixed(2);

        document.getElementById("update").innerText =
          "Actualizado: " + new Date().toLocaleString();
      } catch (error) {
        document.getElementById("rate").innerText =
          "No se pudo obtener la cotización";
      }
    }

    function convert() {
      const usd = parseFloat(document.getElementById("usd").value) || 0;
      const nights = parseInt(document.getElementById("nights").value) || 0;
      const paxArgentino = document.getElementById("paxArgentino").checked;

      if (!exchangeRate) {
        alert("Cotización aún no cargada");
        return;
      }

      const usdPerNights = usd * nights;
      const usdTotalArs = usdPerNights * exchangeRate;
      const nightsArs = nights * NIGHT_PRICE;

      const alojamientoTotal = usdTotalArs + nightsArs;
      const iva = paxArgentino ? alojamientoTotal * 0.21 : 0;
      const total = alojamientoTotal + iva;

      document.getElementById("ars").innerText =
        "$" + total.toLocaleString("es-AR", {
          minimumFractionDigits: 2,
        });

      document.getElementById("detail").innerHTML = `
        <div class="font-semibold mb-2">Detalle del cálculo</div>
        <div>USD × noches: <strong>${usdPerNights.toLocaleString("es-AR")} USD</strong></div>
        <div>USD total de noches × cotización: <strong>$${usdTotalArs.toLocaleString("es-AR")}</strong></div>
        <div>Noches × AR$ 50.000: <strong>$${nightsArs.toLocaleString("es-AR")}</strong></div>
        <div>Alojamiento total: <strong>$${alojamientoTotal.toLocaleString("es-AR")}</strong></div>
        ${paxArgentino ? `<div>IVA 21%: <strong>$${iva.toLocaleString("es-AR")}</strong></div>` : ""}
        <hr class="my-2">
        <div class="font-semibold">TOTAL GARANTÍA: $${total.toLocaleString("es-AR")}</div>
      `;

      localStorage.setItem("previousGuarantee", total);
    }

    function showPrevious() {
      const prev = localStorage.getItem("previousGuarantee");

      if (!prev) {
        alert("No hay garantía calculada previamente");
        return;
      }

      document.getElementById("ars").innerText =
        "$" + parseFloat(prev).toLocaleString("es-AR", {
          minimumFractionDigits: 2,
        });
    }

    function resetCalc() {
      document.getElementById("usd").value = "";
      document.getElementById("nights").value = "";
      document.getElementById("paxArgentino").checked = false;
      document.getElementById("ars").innerText = "—";
      document.getElementById("detail").innerHTML = "";
    }

    fetchRate();
    setInterval(fetchRate, 24 * 60 * 60 * 1000);
  </script>
</body>
</html>
